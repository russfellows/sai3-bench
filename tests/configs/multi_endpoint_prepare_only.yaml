# Multi-Endpoint Distributed Test - PREPARE PHASE ONLY
# Each agent creates files in its assigned endpoint directories
# Agent 1 -> endpoints A & B, Agent 2 -> endpoints C & D

target: file:///tmp/sai3-multi-ep-test/default/
data_size: 524288  # 512KB
record_count: 100

# Global multi-endpoint (fallback for agents without per-agent override)
multi_endpoint:
  strategy: round_robin
  endpoints:
    - "file:///tmp/sai3-multi-ep-test/endpoint-a/"
    - "file:///tmp/sai3-multi-ep-test/endpoint-b/"
    - "file:///tmp/sai3-multi-ep-test/endpoint-c/"
    - "file:///tmp/sai3-multi-ep-test/endpoint-d/"

# Prepare phase: Create objects using multi-endpoint
prepare:
  ensure_objects:
    - base_uri: "testdata/"  # Path component only - agents use their multi_endpoint endpoints
      count: 100
      min_size: 524288
      max_size: 524288
      fill: zero
      use_multi_endpoint: true  # Use agent's assigned endpoints
  cleanup: false  # KEEP FILES for workload phase

# Dummy workload (won't run - prepare-only)
workload:
  - op: put
    path: "dummy-{}.dat"
    object_size: 1024
    weight: 100

duration: 0s

# Distributed configuration with per-agent endpoint assignments
distributed:
  shared_filesystem: true
  tree_creation_mode: coordinator
  path_selection: random
  agents:
    # Agent 1: Creates files in endpoints A and B
    - address: "localhost:7761"
      id: "agent-dc-a"
      concurrency_override: 4
      multi_endpoint:
        endpoints:
          - "file:///tmp/sai3-multi-ep-test/endpoint-a/"
          - "file:///tmp/sai3-multi-ep-test/endpoint-b/"
        strategy: round_robin
    
    # Agent 2: Creates files in endpoints C and D
    - address: "localhost:7762"
      id: "agent-dc-b"
      concurrency_override: 4
      multi_endpoint:
        endpoints:
          - "file:///tmp/sai3-multi-ep-test/endpoint-c/"
          - "file:///tmp/sai3-multi-ep-test/endpoint-d/"
        strategy: least_connections
  
  start_delay: 2
