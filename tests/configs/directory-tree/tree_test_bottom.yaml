# Directory Tree Test - Bottom Distribution (Deep Tree Validation)
# 
# Purpose: Comprehensive validation of bottom-only distribution strategy
#
# Configuration:
#   - Structure: 3-way tree, 4 levels deep (81 leaf directories)
#   - Files: 5 files per leaf directory = 405 total files
#   - Distribution: bottom (files ONLY in leaf directories at depth 4)
#   - Size: Uniform 2-8 KB (2048-8192 bytes)
#   - Fill: Random data, no dedup/compression
#   - Workload: GET only (100%)
#
# Expected Results:
#   - 120 total directories (1 root + 3 + 9 + 27 + 81 across levels)
#   - 405 files total (ONLY in 81 depth-4 directories)
#   - 0 files in directories at depth 1-3
#   - All depth-4 directories have exactly 5 files
#
# Validates:
#   - Strict "bottom" distribution (no files in intermediate directories)
#   - Deep tree structure (4 levels)
#   - Large-scale directory creation (120 total directories)
#   - Global file indexing (405 files with unique indices)
#
# Verification:
#   # Count depth-4 directories (should have files)
#   find /mnt/test/sai3bench-tree-bottom -name "*d4_*.dir" -type d | wc -l  # Should be 81
#   
#   # Verify depth-3 directories have NO direct files
#   find /mnt/test/sai3bench-tree-bottom -name "*d3_*.dir" -type d -exec sh -c 'find "$1" -maxdepth 1 -type f | wc -l' _ {} \;  # All should be 0
#   
#   # Verify depth-4 directories have exactly 5 files each
#   find /mnt/test/sai3bench-tree-bottom -name "*d4_*.dir" -type d -exec sh -c 'ls "$1" | wc -l' _ {} \;  # All should be 5
#
# Usage:
#   ./target/release/sai3-bench run --config tests/configs/directory-tree/tree_test_bottom.yaml --prepare-only
#   ./target/release/sai3-bench -v run --config tests/configs/directory-tree/tree_test_bottom.yaml

version: 1
duration: 5s
concurrency: 4
target: "file:///mnt/test/sai3bench-tree-bottom"

prepare:
  directory_structure:
    width: 3              # 3 subdirectories at each level (3^4 = 81 leaves)
    depth: 4              # 4 levels deep (root + 4)
    files_per_dir: 5      # 5 files per leaf directory
    distribution: "bottom"  # Files ONLY in leaf directories (depth 4)
  
  ensure_objects:
    - base_uri: "file:///mnt/test/sai3bench-tree-bottom"
      count: 0
      size_spec:
        type: "uniform"
        min: 2048
        max: 8192
      fill: "random"
      dedup_factor: 1
      compress_factor: 1

workload:
  - op: "get"
    path: "/"
    weight: 100
