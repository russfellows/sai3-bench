# Metadata Operations Stress Test
# 
# This config intentionally creates race conditions to test error handling:
# - PUT operations may try to write to directories that don't exist yet
# - RMDIR may try to remove directories that don't exist
# - RMDIR may try to remove directories that have files in them
# - High concurrency creates maximum contention

target: "file:///tmp/sai3bench-metadata-stress/"
duration: 10s
concurrency: 16  # High concurrency to maximize race conditions

workload:
  # Create nested directories
  - op: mkdir
    path: "datasets/"
    weight: 20
    
  # Try to write files into those directories (may fail if dir doesn't exist yet)
  - op: put
    path: "datasets/"
    size_distribution: 4096  # 4 KiB files
    weight: 30
    
  # Try to remove directories (may fail if doesn't exist or has files)
  - op: rmdir
    path: "datasets/"
    recursive: false  # Will fail if directory has files
    weight: 20
    
  # Try to remove with recursive (should work even with files)
  - op: rmdir
    path: "datasets/"
    recursive: true
    weight: 10
    
  # List to see what survived
  - op: list
    path: "datasets/"
    weight: 10
    
  # Delete individual files
  - op: delete
    path: "datasets/"
    weight: 10

prepare:
  ensure_objects: []
  cleanup: true
