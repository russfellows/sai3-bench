# Multi-Endpoint Distributed Test Configuration
# Simulates different agents using different endpoint sets
# Uses file:// URIs pointing to different directories as "endpoints"

# Global target for prepare phase (shared storage)
target: file:///tmp/sai3-multi-ep-test/shared/
data_size: 524288  # 512KB
record_count: 100

# Prepare phase: Create objects in shared location
prepare:
  ensure_objects:
    - base_uri: file:///tmp/sai3-multi-ep-test/shared/
      count: 100
      min_size: 524288
      max_size: 524288
      fill: zero
      use_multi_endpoint: false  # Single target for prepare
  cleanup: true

# Workload phase
workload:
  - op: get
    path: "**/*"
    weight: 60
  - op: put
    path: "newfile-{}.dat"
    object_size: 524288
    weight: 30
  - op: list
    path: "**/"
    weight: 10

duration: 15s
concurrency: 4

# Distributed configuration with per-agent endpoint assignments
distributed:
  shared_filesystem: true  # Using file:// URIs on same host
  tree_creation_mode: coordinator
  path_selection: random
  agents:
    # Agent 1: Uses "endpoints" A and B (simulating DC-A storage nodes)
    - address: "localhost:7761"
      id: "agent-dc-a"
      concurrency_override: 4
      multi_endpoint:
        endpoints:
          - "file:///tmp/sai3-multi-ep-test/endpoint-a/"
          - "file:///tmp/sai3-multi-ep-test/endpoint-b/"
        strategy: round_robin
    
    # Agent 2: Uses "endpoints" C and D (simulating DC-B storage nodes)
    - address: "localhost:7762"
      id: "agent-dc-b"
      concurrency_override: 4
      multi_endpoint:
        endpoints:
          - "file:///tmp/sai3-multi-ep-test/endpoint-c/"
          - "file:///tmp/sai3-multi-ep-test/endpoint-d/"
        strategy: least_connections
  
  start_delay: 2

# Performance logging
perf_log:
  enabled: true
  path: "perf_log.tsv"
  interval_seconds: 1
